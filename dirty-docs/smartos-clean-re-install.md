+--------------------------------------------------------------------------+
<div class="pageheader">

<span class="pagetitle"> SmartOS Documentation : SmartOS Clean
Re-install </span>

</div>

<div class="pagesubheading">

This page last changed on Apr 26, 2014 by
<font color="#0050B2">ryan</font>.

</div>

SmartOS Clean Re-install
============================

SmartOS can be re-installed clean on a previously used system after
removing the old persistent zpool made by the installation script.\
This zpool is named "zones" by default.

<div class="panelMacro">

  ----------------------------------------------------------------- ----
------------------------------------------------------------------------
------------------------------------------------------------------------
------------------------------------------------------------------------
-----------------------------
  ![](images/icons/emoticons/warning.gif){width="16" height="16"}   Migr
ate all important ZFS snapshots, VM datasets, KVM images, /usbkey/config
 NIC settings, or persistent SMF scripts that you want to keep onto anot
her system. This procedure WILL DESTROY all the persistent information s
tored in ZFS on the system.
  ----------------------------------------------------------------- ----
------------------------------------------------------------------------
------------------------------------------------------------------------
------------------------------------------------------------------------
-----------------------------

</div>

Reboot SmartOS from media and choose the GRUB menu \[Live
64-bit(noinstall)\] option.\
This disables the setup script and avoids importing and activating the
persistent zpool.

Login and password are both "root" for single user (noinstall) mode.

From a SmartOS prompt the system can be scheduled for a factory reset
(which will **DELETE** your zpools and the data on them) on the next
reboot:

<div class="code panel" style="border-width: 1px;">

<div class="codeContent panelContent">

<div id="root">

``` {.theme: .Confluence; .brush: .java; .gutter: .false}
#zfs set smartdc:factoryreset=yes zones/var
#reboot
```

</div>

</div>

</div>

Reboot will take you back to the GRUB menu, and the default installation
script will be activated after timeout.

<div class="panelMacro">

  ----------------------------------------------------------------- ----
------------------------------------------------------------------------
------------------------------------------------------------------------
---------------------------
  ![](images/icons/emoticons/warning.gif){width="16" height="16"}   If y
ou can't or want to avoid boot, you can set **destroy\_zpools=true** in
grub boot params to do the same thing. WARNING: this will destroy **ALL*
* zpools, not just zones.
  ----------------------------------------------------------------- ----
------------------------------------------------------------------------
------------------------------------------------------------------------
---------------------------

</div>

NOW you should be at the point where you can reboot with a system
with raidz2 with compression.

The system will find no old zpool to refer to on the drive and it is
ready for a clean installation.

### Changing the zpool default configuration

Using the method, i.e., choosing the GRUB menu \[Live
64-bit(noinstall)\] option we can recreate the zpool with a different
configuration (a raidz1 by default):

<div class="code panel" style="border-width: 1px;">

<div class="codeContent panelContent">

<div id="root">

``` {.theme: .Confluence; .brush: .java; .gutter: .false}
# zpool import zones
# zpool destroy zones
```

</div>

</div>

</div>

Now, instead of rebooting the OS, you can create a new zpool with
different options:

<div class="code panel" style="border-width: 1px;">

<div class="codeContent panelContent">

<div id="root">

``` {.theme: .Confluence; .brush: .java; .gutter: .false}
# zpool create zones raidz2 c0t1d0 c1t1d0 c4t1d0 c5t1d0 c6t1d0 c7t1d02
```

</div>

</div>

</div>

NOW you should be at the point where you can reboot with a system
with raidz2.

From [the mailing
list](http://www.listbox.com/member/archive/184463/2013/09/sort/time_rev
/page/1/entry/11:119/20130911232921:808DAAE6-1B5B-11E3-AC7D-B76A33434032
/).
Thanks to Christopher W.V. Hogue.
+--------------------------------------------------------------------------+

  ----------------------------------------------------------------------------------
  ![](images/border/spacer.gif){width="1" height="1"}
  <font color="grey">Document generated by Confluence on Jul 07, 2019 00:15</font>
  ----------------------------------------------------------------------------------


